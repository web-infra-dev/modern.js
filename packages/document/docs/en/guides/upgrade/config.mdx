# Configuration Changes

This document mainly introduces incompatible changes at the configuration level and recommended migration methods when upgrading from Modern.js 2.0 to 3.0.

## html

### html.appIcon

**Change**: String format is no longer supported, object format must be used.

**V2 Type**:

```typescript
type AppIconItem = {
  src: string;
  size: number;
  target?: 'apple-touch-icon' | 'web-app-manifest';
};

type AppIcon =
  | string
  | {
      name?: string;
      icons: AppIconItem[];
      filename?: string;
    };
```

**V3 Type**:

```typescript
type AppIconItem = {
  src: string;
  size: number;
  target?: 'apple-touch-icon' | 'web-app-manifest';
};

type AppIcon = {
  name?: string;
  icons: AppIconItem[];
  filename?: string;
};
```

**Migration Example**:

```typescript
// v2
export default {
  html: {
    appIcon: './src/assets/icon.png',
  },
};

// v3
export default {
  html: {
    appIcon: {
      icons: [
        {
          src: './src/assets/icon.png',
          size: 180,
        },
      ],
    },
  },
};
```

### html.xxxByEntries

**Change**: Configurations such as `metaByEntries`, `templateParametersByEntries`, `injectByEntries`, `tagsByEnties`, `faviconByEntries`, `templateByEnties`, `titleByEntries` are deprecated and need to be replaced with function syntax.

**Steps**:

1. Remove related configurations
2. Use the function syntax of `html.xxx` instead

**Migration Example**:

```typescript
// v2
export default {
  html: {
    metaByEntries: {
      foo: {
        description: 'TikTok',
      },
      // other configurations...
    },
  },
};

// v3
export default {
  html: {
    meta({ entryName }) {
      switch (entryName) {
        case 'foo':
          return {
            description: 'TikTok',
          };
        // other configurations...
      }
    },
  },
};
```

### html.disableHtmlFolder

**Change**: This configuration is deprecated, use `html.outputStructure` instead.

**Migration Example**:

```typescript
// v2 - equivalent to html.outputStructure set to nested
export default {
  html: {
    disableHtmlFolder: true,
  },
};

// v3
export default {
  html: {
    outputStructure: 'flat',
  },
};
```

## output

### output.overrideBrowserslist

**Change**: Needs to be handled based on the project's existing configuration.

**Steps**:

1. Check if there is a `.browserslistrc` file in the project
2. Check if `output.overrideBrowserslist` is configured in `modern.config.[ts|js]`
3. Check if browserslist is configured in package.json

If none exist, create a `.browserslistrc` file with browsers that support ES6:

```typescript
chrome >= 51;
edge >= 15;
firefox >= 54;
safari >= 10;
ios_saf >= 10;
```

### output.enableAssetFallback

**Change**: This configuration is deprecated, comment it out and add a note.

```typescript
// This configuration is deprecated, please contact oncall if you have issues
// output: {
//   enableAssetFallback: true,
// },
```

### output.cssModuleLocalIdentName

**Change**: This configuration is deprecated, use `output.cssModules.localIdentName` instead.

**Migration Example**:

```typescript
// v2
export default {
  output: {
    cssModuleLocalIdentName: '[path][name]__[local]-[hash:base64:6]',
  },
};

// v3
export default {
  output: {
    cssModules: {
      localIdentName: '[path][name]__[local]-[hash:base64:6]',
    },
  },
};
```

### output.disableCssExtract

**Change**: This configuration is deprecated, use `output.injectStyles` instead.

**Migration Example**:

```typescript
// v2
export default {
  output: {
    disableCssExtract: true,
  },
};

// v3
export default {
  output: {
    injectStyles: true,
  },
};
```

### output.disableFilenameHash

**Change**: This configuration is deprecated, use `output.filenameHash` instead.

**Migration Example**:

```typescript
// v2
export default {
  output: {
    disableFilenameHash: true,
  },
};

// v3
export default {
  output: {
    filenameHash: false,
  },
};
```

### output.disableMinimize

**Change**: This configuration is deprecated, use `output.minify` instead.

**Migration Example**:

```typescript
// v2
export default {
  output: {
    disableMinimize: true,
  },
};

// v3
export default {
  output: {
    minify: false,
  },
};
```

### output.disableSourceMap

**Change**: This configuration is deprecated, use `output.sourceMap` instead.

**Migration Example**:

```typescript
// v2
export default {
  output: {
    disableSourceMap: true,
  },
};

// v3
export default {
  output: {
    sourceMap: false,
  },
};
```

### output.enableInlineScripts

**Change**: This configuration is deprecated, use `output.inlineScripts` instead.

**Migration Example**:

```typescript
// v2
export default {
  output: {
    enableInlineScripts: true,
  },
};

// v3
export default {
  output: {
    inlineScripts: true,
  },
};
```

### output.enableInlineStyles

**Change**: This configuration is deprecated, use `output.inlineStyles` instead.

**Migration Example**:

```typescript
// v2
export default {
  output: {
    enableInlineStyles: true,
  },
};

// v3
export default {
  output: {
    inlineStyles: true,
  },
};
```

### output.enableLatestDecorators

**Change**: This configuration is deprecated, use `source.decorators` instead.

**Migration Example**:

```typescript
// v2
export default {
  output: {
    enableLatestDecorators: true,
  },
};

// v3
export default {
  source: {
    decorators: {
      version: '2022-03',
    },
  },
};
```

### output.disableNodePolyfill

**Change**: This configuration is deprecated, use `pluginNodePolyfill` registration instead.

**Migration Example**:

```typescript
// v2
export default {
  output: {
    disableNodePolyfill: false,
  },
};

// v3
import { pluginNodePolyfill } from '@rsbuild/plugin-node-polyfill';
export default {
  builderPlugins: [pluginNodePolyfill()],
};
```

## source

### source.resolveMainFields

**Change**: This configuration is deprecated, use `resolve.mainFields` instead.

**Migration Example**:

```typescript
// v2
source: {
  resolveMainFields: ['custom', 'module', 'main'];
}

// v3
resolve: {
  mainFields: ['custom', 'module', 'main'];
}
```

### source.resolveExtensionPrefix

**Change**: This configuration is deprecated, use `resolve.extensions` instead.

**Migration Example**:

```typescript
// v2
source: {
  resolveExtensionPrefix: ['.ts', '.tsx', '.js'];
}

// v3
resolve: {
  extensions: ['.ts', '.tsx', '.js'];
}
```

### source.moduleScopes

**Change**: This configuration is deprecated, remove it directly.

### source.enableCustomEntry

**Change**: This configuration is deprecated, remove it directly.

### source.disableEntryDirs

**Change**: This configuration is deprecated, remove it directly.

## tools

### tools.esbuild

**Change**: This configuration is deprecated, need to manually switch to esbuild minification.

```typescript
// This configuration is deprecated, please refer to [Switching Minifier](https://rsbuild.rs/config/output/minify#switching-minifier) to manually switch to esbuild minification
// tools: {
//   esbuild: { /* configuration */ }
// },
```

### tools.terser

**Change**: This configuration is deprecated, need to manually switch to Terser minification.

```typescript
// This configuration is deprecated, please refer to [Switching Minifier](https://rsbuild.rs/config/output/minify#switching-minifier) to manually switch to Terser minification
// tools: {
//   terser: { /* configuration */ }
// },
```

### tools.devServer

**Change 1**: `after`, `before`, `devMiddleware` configurations are deprecated, use `dev` configuration instead.

**Migration Example**:

```typescript
// v2
export default {
  tools: {
    devServer: {
      before: [...],
      after: [...],
      devMiddleware: {
        writeToDisk: true
      }
    }
  }
};

// v3
export default {
  dev: {
    setupMiddlewares: [...],
    writeToDisk: true
  }
};
```

**Change 2**: `client`, `https`, `liveReload` configurations are deprecated, use corresponding `dev.client`, `dev.https`, `dev.liveReload` configurations instead.

**Migration Example**:

```typescript
// v2
export default {
  tools: {
    devServer: {
      client: {
        port: 8081,
      },
    },
  },
};

// v3
export default {
  dev: {
    client: {
      port: 8081,
    },
  },
};
```

**Change 3**: `hot` configuration is deprecated, use `dev.hmr` configuration instead.

**Migration Example**:

```typescript
// v2
export default {
  tools: {
    devServer: {
      hot: false,
    },
  },
};

// v3
export default {
  dev: {
    hmr: false,
  },
};
```

## dev

### dev.port

**Change**: This configuration has been removed, changed to `server.port`.

**Migration Example**:

```typescript
// Before change
dev: {
  port: 8080;
}

// After change
server: {
  port: process.env.NODE_ENV === 'development' ? 8080 : undefined;
}
```

## runtime

### runtime.router

**Change**: No longer needed, can be removed directly.

### runtime.state

**Change**: This configuration is deprecated, it is recommended to use a third-party state management library.

## experiments

### experiments.lazyCompilation

**Change**: This configuration is deprecated, changed to `dev.lazyCompilation`.

**Migration Example**:

```typescript
// v2
experiments: {
  lazyCompilation: true;
}

// v3
dev: {
  lazyCompilation: true;
}
```

## plugins

### app-tools plugin

**Change**: This plugin does not need any parameters.

**Migration Example**:

```typescript
// v2
plugins: [
  appTools({
    bundler: 'rspack'
  })
],

// v3
plugins: [
  appTools()
],
```

## performance

### performance.transformLodash

**Change**: No longer needed, can be removed directly.

**Migration Example**:

```typescript
// v2
export default {
  performance: {
    transformLodash: true,
  },
};

// v3 - remove this configuration directly
export default {
  // configuration...
};
```
