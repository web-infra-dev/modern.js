---
title: 总览
sidebar_position: 1
---

# 总览

此节将介绍 Runtime 插件的配置。

## 开启 Runtime 插件

Runtime 插件分为两种，一种是纯 Runtime 插件，一种是 CLI 插件 + Runtime 插件的配置。

对于纯 Runtime 插件，插件配置需要在 src/modern.runtime.ts 中配置，将插件直接注册到 plugins 字段中：

```ts title="src/modern.runtime.ts"
import { definePluginConfig } from '@modern-js/runtime';

export default definePluginConfig({
  plugins: [runtimePlugin({...params})]
})
```

对于 CLI 插件 + Runtime 插件，通常 CLI 插件会自动注册 Runtime 插件，只需注册 CLI 插件，无需再重复注册，但是需要在 `modern.config.ts` 中配置开启插件：

```ts title="modern.config.ts"
import { defineConfig } from '@modern-js/app-tools';

export default defineConfig({
  runtime: {
    state: true,
    router: true,
  },
  plugins: [customPlugin({ enable: true })]
});
```

Modern.js 提供的 Runtime 插件都为 CLI + Runtime 插件的形式，并且 router 和 state 插件内置，无需注册。

## 配置 Runtime 插件参数

对于内置的 Runtime 插件，支持在 src/modern.runtime.ts 中进行配置。

:::info
Modern.js 之前的配置方式为在 `modern.config.ts` runtime 配置中进行配置，但是无法配置函数等动态参数。
:::

```ts title="src/modern.runtime.ts"
import { definePluginConfig } from '@modern-js/runtime';

export default definePluginConfig({
  router: {
    supportHtml5History: false,
  }
})
```

对于自定义的 Runtime 插件，可以在注册 Runtime 插件时自动注册配置信息

```ts title="src/modern.runtime.ts"
import { definePluginConfig } from '@modern-js/runtime';
export default definePluginConfig({
  plugins: [customPlugin({ param: 'test' })]
})
```

## 多入口插件配置

对于纯 Runtime 插件，可以直接在 src/modern.runtime.ts 中通过函数判断入口名称决定 Runtime 插件是否注册生效

```ts title="src/modern.runtime.ts"
import { definePluginConfig } from '@modern-js/runtime';
export default definePluginConfig((entryName: string) => {
  if (entryName === 'entry1') {
    return {
      plugins: [customPlugin({ param: 'test' })]
    }
  }
  return { plugins: []}
})
```

对于 CLI + runtime 插件，需要在 modern.config.ts 中通过 runtimeByEntries 进行开启插件，插件的动态配置再配置 src/modern.runtime.ts 的函数形式使用。

```ts title="modern.config.ts"
import { defineConfig } from '@modern-js/app-tools';

export default defineConfig({
  runtime: {
    state: false,
  },
  runtimeByEntries: {
    entry1: {
      state: true, // { state: true }
    },
    entry2: {
      // { state: false, router: true }
      router: true,
    },
  },
});
```

```ts title="src/modern.runtime.ts"
import { definePluginConfig } from '@modern-js/runtime';
export default definePluginConfig((entryName: string) => {
  if (entryName === 'entry1') {
    return {
      router: {
        supportHtml5History: true
      }
    }
  }
  return {}
})
```
